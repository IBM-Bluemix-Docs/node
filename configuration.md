---

copyright:
  years: 2018, 2020
lastupdated: "2020-10-02"

keywords: configure node env, node environment, node credentials, ibm-cloud-env node, service credentials, credentials, variables, configuration

subcollection: node

---

{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:external: target="_blank" .external}

# Configuring the Node.js environment
{: #configure-nodejs}

By implementing cloud-native principles, a Node.js application can move from one environment to another, from testing into production, without changing code or exercising otherwise untested code paths.

The problem arises when significant differences exist in the way the config is presented, depending on the development environment. For example, Cloud Foundry, which uses stringified JSON objects versus Kubernetes that uses either flat values or stringified JSON objects. Local development, aside from Kubernetes, has different considerations as well. Credentials can be presented differently across public and private, which further make it difficult for apps to be unchanged across environments.

Whether you need to add {{site.data.keyword.cloud}} support to existing applications or create apps with Starter Kits, the goal is to provide portability for Node.js apps on any development platform.

## Adding {{site.data.keyword.cloud_notm}} configuration to existing Node.js applications
{: #addcloud-env-nodejs}

The [`ibm-cloud-env`](https://github.com/ibm-developer/ibm-cloud-env){: external} module aggregates environment variables from various Cloud providers, such as Cloud Foundry and Kubernetes, so the application is independent of the environment.

### Installing the `ibm-cloud-env` module
{: #install-module-nodejs}

1. Install the `ibm-cloud-env` module with the following command:
  ```
  npm install ibm-cloud-env
  ```
  {: codeblock}

2. Initialize the module in your code by referencing the `mappings.json` like so:
  ```js
  var IBMCloudEnv = require('ibm-cloud-env');
  IBMCloudEnv.init("/path/to/the/mappings/file/relative/to/project/root");
  ```
  {: codeblock}

  If the mappings file path isn't specified in `IBMCloudEnv.init()`, the module tries to load mappings from a default path of `/server/config/mappings.json`.
  {: tip}

  Example `mappings.json` file:
  ```json
  {
    "service1-credentials": {
        "searchPatterns": [
            "cloudfoundry:my-service1-instance-name", 
            "env:my-service1-credentials", 
            "file:/localdev/my-service1-credentials.json" 
        ]
    },
    "service2-username": {
        "searchPatterns":[
            "cloudfoundry:$.service2[@.name=='my-service2-instance-name'].credentials.username",
            "env:my-service2-credentials:$.username",
            "file:/localdev/my-service1-credentials.json:$.username" 
        ]
    }
  }
  ```
  {: codeblock}

### Retrieving service credentials
{: #nodejs-get-creds}

Retrieve the values in your application by using the following commands.

1. Retrieve variable `service1credentials`:
  ```js
  // this will be a dictionary
  var service1credentials = IBMCloudEnv.getDictionary("service1-credentials");
  ```
  {: codeblock}

2. Retrieve variable `service2username`:
  ```js
  var service2username = IBMCloudEnv.getString("service2-username"); // this will be a string
  ```
  {: codeblock}

Now your application can be implemented in any runtime-environment by abstracting the differences that are introduced from different Cloud compute providers.

### Filtering the values for tags and labels
{: #filter-values-nodejs}

You can filter credentials that are generated by the module based on service tags and service labels as shown in the following example:
```js
var filtered_credentials = IBMCloudEnv.getCredentialsForService('tag', 'label', credentials)); // returns a Json with credentials for specified service tag and label
```
{: codeblock}

## Using the Node.js configuration manager from starter kit apps
{: #nodejs-config-skit}

Node.js apps that are created with [starter kits](https://cloud.ibm.com/developer/appservice/starter-kits){: external} automatically come with credentials and configurations that are needed to run in many cloud deployment targets, such as [Kubernetes](/docs/containers?topic=containers-getting-started) and [Cloud Foundry](/docs/cloud-foundry?topic=cloud-foundry-what-is-cloud-foundry#ibmcf-offerings).

### Understanding service credentials
{: #credentials-nodejs}

Your application configuration information for services is stored in the `localdev-config.json` file in the `/server/config` directory. The file is in the `.gitignore` directory to prevent sensitive information from being stored in Git. The connection information for any configured service that runs locally, such as user name, password, and host name, is stored in this file.

The application uses the configuration manager to read the connection and configuration information from the environment and this file. It uses a custom-built `mappings.json`, which is located in the `server/config` directory, to communicate where the credentials can be found for each service.

Locally running applications can connect to {{site.data.keyword.cloud_notm}} services by using unbound credentials that are read from the `mappings.json` file. If you need to create unbound credentials, you can do so from the [{{site.data.keyword.cloud_notm}} console](https://{DomainName}){: external}, or by using the [Cloud Foundry CLI](https://docs.cloudfoundry.org/cf-cli/){: external} `cf create-service-key` command.

When you push your application to {{site.data.keyword.cloud_notm}}, these values are no longer used. Instead, the application automatically connects to bound services by using environment variables.

* **Cloud Foundry**: Service credentials are taken from the `VCAP_SERVICES` environment variable. For Cloud Foundry Enterprise Edition, see this [getting started tutorial](/docs/cloud-foundry?topic=cloud-foundry-getting-started#getting-started) for more information.

* **Kubernetes**: Service credentials are taken from individual environment variables per service.

## Next steps
{: #next_steps-config notoc}

The `ibm-cloud-config` supports searching for values by using four search pattern types: `user-provided`, `cloudfoundry`, `env`, and `file`. If you want to check out other supported search patterns and search pattern examples, check the [Usage](https://github.com/ibm-developer/ibm-cloud-env#usage){: external} section.
